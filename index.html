<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="description" content="Magic Chess - Aplikasi Prediksi Urutan Musuh">
    <title>Magic Chess - Prediksi Urutan</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
        }
        
        .dragging {
            opacity: 0.5;
            transform: scale(1.02);
        }
        
        .drag-over {
            border-top: 3px solid #f59e0b;
        }
        
        .glow {
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.3);
        }
        
        .opponent-item {
            transition: all 0.3s ease;
        }
        
        .opponent-item:hover {
            transform: translateX(5px);
        }
        
        .eliminated {
            background: linear-gradient(135deg, #7f1d1d 0%, #450a0a 100%) !important;
            border-color: #dc2626 !important;
            opacity: 0.7;
        }
        
        .eliminated .player-name {
            text-decoration: line-through;
        }
        
        .fighting {
            background: linear-gradient(135deg, #065f46 0%, #064e3b 100%) !important;
            border-color: #10b981 !important;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.4);
        }
        
        .eliminate-btn {
            transition: all 0.3s ease;
        }
        
        .eliminate-btn:active {
            transform: scale(0.95);
        }
        
        /* Install prompt styling */
        #installPrompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(245, 158, 11, 0.5);
            display: none;
            z-index: 1000;
            animation: slideUp 0.5s ease;
        }
        
        @keyframes slideUp {
            from {
                transform: translateX(-50%) translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body class="p-4">
    <!-- Install Prompt -->
    <div id="installPrompt">
        <div class="flex items-center space-x-4">
            <div class="text-gray-900">
                <p class="font-bold">üì± Install Magic Chess</p>
                <p class="text-sm">Install sebagai aplikasi desktop</p>
            </div>
            <button id="installBtn" class="px-6 py-2 font-bold transition bg-gray-900 rounded-lg text-amber-400 hover:bg-gray-800">
                Install
            </button>
            <button id="dismissBtn" class="px-4 py-2 text-white transition bg-gray-800 rounded-lg hover:bg-gray-700">
                ‚úï
            </button>
        </div>
    </div>

    <div class="max-w-2xl mx-auto">
        <!-- Header -->
        <div class="mt-4 mb-8 text-center">
            <h1 class="mb-2 text-4xl font-bold text-amber-400">‚öîÔ∏è Magic Chess</h1>
            <p class="text-sm text-gray-300">Prediksi Urutan Musuh</p>
            <p class="mt-1 text-xs text-gray-500" id="appStatus">
                <span id="onlineStatus">üü¢ Online</span>
            </p>
        </div>

        <!-- Step 1: Input Form -->
        <div id="inputSection" class="p-6 mb-6 bg-gray-800 rounded-lg shadow-2xl glow">
            <h2 class="mb-4 text-2xl font-bold text-amber-400">üìù Masukkan Nama 7 Musuh</h2>
            <div id="inputFields" class="mb-4 space-y-3">
                <!-- Input fields will be generated here -->
            </div>
            <button onclick="saveOpponents()" 
                    class="w-full px-4 py-3 font-bold text-gray-900 transition duration-300 transform rounded-lg bg-amber-500 hover:bg-amber-600 hover:scale-105">
                üéØ Simpan & Mulai Prediksi
            </button>
        </div>

        <!-- Step 2: Reorderable List -->
        <div id="predictionSection" class="hidden p-6 bg-gray-800 rounded-lg shadow-2xl glow">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-2xl font-bold text-amber-400">üîÆ Atur Urutan Musuh</h2>
                <button onclick="resetApp()" 
                        class="px-4 py-2 text-sm text-white transition duration-300 bg-red-600 rounded-lg hover:bg-red-700">
                    üîÑ Reset
                </button>
            </div>
            <p class="mb-4 text-sm text-gray-300">Seret dan lepas untuk mengatur urutan prediksi</p>
            
            <div id="opponentList" class="space-y-3">
                <!-- Draggable items will be generated here -->
            </div>
            
            <div class="p-6 mt-6 border-2 rounded-lg bg-gradient-to-br from-amber-900 to-gray-900 border-amber-500 glow">
                <h3 class="mb-2 text-2xl font-bold text-center text-amber-400">üìä URUTAN PREDIKSI</h3>
                <p class="mb-4 text-sm text-center text-gray-300">
                    üí° Klik player = Fighting | Kill = Eliminasi | Undo = Batalkan
                </p>
                <ol id="orderDisplay" class="space-y-3">
                    <!-- Order will be displayed here -->
                </ol>
            </div>
        </div>
    </div>

    <script>
        let opponents = [];
        let draggedElement = null;
        let eliminatedPlayers = new Set();
        let fightingPlayer = null;
        let deferredPrompt;

        const STORAGE_KEYS = {
            opponents: 'magicChess_opponents',
            eliminated: 'magicChess_eliminated',
            fighting: 'magicChess_fighting'
        };

        // PWA Installation
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPrompt').style.display = 'block';
        });

        document.getElementById('installBtn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response: ${outcome}`);
                deferredPrompt = null;
                document.getElementById('installPrompt').style.display = 'none';
            }
        });

        document.getElementById('dismissBtn').addEventListener('click', () => {
            document.getElementById('installPrompt').style.display = 'none';
        });

        // Online/Offline Status
        window.addEventListener('online', () => {
            document.getElementById('onlineStatus').innerHTML = 'üü¢ Online';
        });

        window.addEventListener('offline', () => {
            document.getElementById('onlineStatus').innerHTML = 'üî¥ Offline';
        });

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(reg => console.log('Service Worker registered!', reg))
                    .catch(err => console.log('Service Worker registration failed:', err));
            });
        }

        function saveToLocalStorage() {
            localStorage.setItem(STORAGE_KEYS.opponents, JSON.stringify(opponents));
            localStorage.setItem(STORAGE_KEYS.eliminated, JSON.stringify([...eliminatedPlayers]));
            localStorage.setItem(STORAGE_KEYS.fighting, fightingPlayer || '');
        }

        function loadFromLocalStorage() {
            const savedOpponents = localStorage.getItem(STORAGE_KEYS.opponents);
            const savedEliminated = localStorage.getItem(STORAGE_KEYS.eliminated);
            const savedFighting = localStorage.getItem(STORAGE_KEYS.fighting);

            if (savedOpponents) {
                opponents = JSON.parse(savedOpponents);
                eliminatedPlayers = new Set(JSON.parse(savedEliminated || '[]'));
                fightingPlayer = savedFighting || null;

                if (opponents.length > 0) {
                    document.getElementById('inputSection').classList.add('hidden');
                    document.getElementById('predictionSection').classList.remove('hidden');
                    generateOpponentList();
                    updateOrderDisplay();
                }
            }
        }

        function initInputFields() {
            const container = document.getElementById('inputFields');
            for (let i = 1; i <= 7; i++) {
                const div = document.createElement('div');
                div.className = 'flex items-center space-x-2';
                div.innerHTML = `
                    <span class="w-8 font-bold text-amber-400">${i}.</span>
                    <input type="text" 
                           id="opponent${i}" 
                           placeholder="Nama musuh ${i}"
                           class="flex-1 px-4 py-2 text-white bg-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"
                           maxlength="30">
                `;
                container.appendChild(div);
            }
        }

        function saveOpponents() {
            opponents = [];
            let allFilled = true;
            
            for (let i = 1; i <= 7; i++) {
                const input = document.getElementById(`opponent${i}`);
                const name = input.value.trim();
                
                if (name === '') {
                    allFilled = false;
                    input.classList.add('ring-2', 'ring-red-500');
                } else {
                    input.classList.remove('ring-2', 'ring-red-500');
                    opponents.push(name);
                }
            }
            
            if (!allFilled) {
                alert('‚ö†Ô∏è Mohon isi semua 7 nama musuh!');
                return;
            }
            
            document.getElementById('inputSection').classList.add('hidden');
            document.getElementById('predictionSection').classList.remove('hidden');
            
            eliminatedPlayers.clear();
            fightingPlayer = null;
            
            generateOpponentList();
            updateOrderDisplay();
            saveToLocalStorage();
        }

        function generateOpponentList() {
            const container = document.getElementById('opponentList');
            container.innerHTML = '';
            
            opponents.forEach((name, index) => {
                const div = document.createElement('div');
                div.className = 'opponent-item bg-gray-700 p-4 rounded-lg cursor-move flex items-center space-x-3 border-2 border-gray-600 hover:border-amber-500';
                div.draggable = true;
                div.dataset.index = index;
                
                div.innerHTML = `
                    <span class="text-2xl">‚ò∞</span>
                    <span class="flex items-center justify-center w-8 h-8 text-sm font-bold text-gray-900 rounded-full bg-amber-500">
                        ${index + 1}
                    </span>
                    <span class="flex-1 font-semibold text-white">${name}</span>
                    <span class="text-sm text-gray-400">‚ÜïÔ∏è</span>
                `;
                
                div.addEventListener('dragstart', handleDragStart);
                div.addEventListener('dragend', handleDragEnd);
                div.addEventListener('dragover', handleDragOver);
                div.addEventListener('drop', handleDrop);
                div.addEventListener('dragenter', handleDragEnter);
                div.addEventListener('dragleave', handleDragLeave);
                
                container.appendChild(div);
            });
        }

        function handleDragStart(e) {
            draggedElement = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.innerHTML);
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            document.querySelectorAll('.opponent-item').forEach(item => {
                item.classList.remove('drag-over');
            });
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDragEnter(e) {
            if (this !== draggedElement) {
                this.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            this.classList.remove('drag-over');
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            
            if (draggedElement !== this) {
                const draggedIndex = parseInt(draggedElement.dataset.index);
                const targetIndex = parseInt(this.dataset.index);
                
                const temp = opponents[draggedIndex];
                opponents[draggedIndex] = opponents[targetIndex];
                opponents[targetIndex] = temp;
                
                generateOpponentList();
                updateOrderDisplay();
                saveToLocalStorage();
            }
            
            return false;
        }

        function updateOrderDisplay() {
            const container = document.getElementById('orderDisplay');
            container.innerHTML = '';
            
            opponents.forEach((name, index) => {
                const li = document.createElement('li');
                const isEliminated = eliminatedPlayers.has(name);
                const isFighting = fightingPlayer === name;
                
                li.className = `bg-gray-800 rounded-lg p-4 flex items-center space-x-3 border-2 border-gray-600 hover:border-amber-400 transition duration-300 ${isEliminated ? 'eliminated' : ''} ${isFighting ? 'fighting' : ''}`;
                
                li.innerHTML = `
                    <div class="bg-amber-500 text-gray-900 font-black w-12 h-12 rounded-full flex items-center justify-center text-xl shadow-lg ${isEliminated ? 'opacity-50' : ''}" 
                         onclick="event.stopPropagation(); toggleFighting('${name}');"
                         style="cursor: pointer;">
                        ${index + 1}
                    </div>
                    <div class="flex-1" onclick="toggleFighting('${name}');" style="cursor: pointer;">
                        <div class="text-lg font-bold text-white player-name">${name}</div>
                        <div class="text-sm text-gray-400">
                            ${isEliminated ? 'üíÄ Eliminated' : isFighting ? '‚öîÔ∏è Fighting!' : 'Posisi ke-' + (index + 1)}
                        </div>
                    </div>
                    <div class="text-3xl">
                        ${isEliminated ? 'üíÄ' : isFighting ? '‚öîÔ∏è' : (index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üéØ')}
                    </div>
                    ${isEliminated ? `
                        <button onclick="event.stopPropagation(); undoElimination('${name}');" 
                                class="flex items-center px-4 py-2 space-x-1 text-sm font-bold text-white bg-green-600 rounded-lg shadow-lg eliminate-btn hover:bg-green-700">
                            <span>‚Ü©Ô∏è</span>
                            <span>Undo</span>
                        </button>
                    ` : `
                        <button onclick="event.stopPropagation(); eliminatePlayer('${name}');" 
                                class="flex items-center px-4 py-2 space-x-1 text-sm font-bold text-white bg-red-600 rounded-lg shadow-lg eliminate-btn hover:bg-red-700">
                            <span>üíÄ</span>
                            <span>Kill</span>
                        </button>
                    `}
                `;
                container.appendChild(li);
            });
        }
        
        function toggleFighting(playerName) {
            if (eliminatedPlayers.has(playerName)) {
                return;
            }
            
            if (fightingPlayer === playerName) {
                fightingPlayer = null;
            } else {
                fightingPlayer = playerName;
            }
            updateOrderDisplay();
            saveToLocalStorage();
        }
        
        function eliminatePlayer(playerName) {
            eliminatedPlayers.add(playerName);
            if (fightingPlayer === playerName) {
                fightingPlayer = null;
            }
            updateOrderDisplay();
            saveToLocalStorage();
        }
        
        function undoElimination(playerName) {
            eliminatedPlayers.delete(playerName);
            updateOrderDisplay();
            saveToLocalStorage();
        }

        function resetApp() {
            if (confirm('üîÑ Yakin ingin mereset? Data akan hilang.')) {
                opponents = [];
                eliminatedPlayers.clear();
                fightingPlayer = null;
                
                localStorage.removeItem(STORAGE_KEYS.opponents);
                localStorage.removeItem(STORAGE_KEYS.eliminated);
                localStorage.removeItem(STORAGE_KEYS.fighting);
                
                for (let i = 1; i <= 7; i++) {
                    document.getElementById(`opponent${i}`).value = '';
                }
                
                document.getElementById('inputSection').classList.remove('hidden');
                document.getElementById('predictionSection').classList.add('hidden');
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            initInputFields();
            loadFromLocalStorage();
        });
    </script>
</body>
</html>